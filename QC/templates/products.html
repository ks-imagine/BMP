<!-- templates/products.html -->

{% extends "base.html" %}

{% block content %}
<h1 class="title">
    All Products
</h1>
<h2><a onclick="toggleForm()">Add Product +</a></h2>
<h3 style="color: green;">{{ status_good }}</h3>
<h3 style="color: yellow;">{{ status_bad }}</h3>

{% with messages = get_flashed_messages() %}
    {% if messages %}
    {% for message in messages %}
    <h3 style="color: red;">
        {{ message }}
    </h3>
    {% endfor %}
    {% endif %}
{% endwith %}



<div class="center content" id="addProduct" style="display: none;">
    <form method="POST">
        <p>
            <label for="bmpid">BMP Product Number &nbsp;&nbsp;&nbsp;</label>
            <input type="number" id="bmpid" name="bmpid" value="12345">
        </p>
        <p>
            <label for="desc">Product Description</label>
            <input type="text" id="desc" name="desc" value="Doe">
        </p>
        <p>
            <label for="customer">Customer</label>
            <select id="customer" name="customer">
                <option value="Blow Molded Products">Blow Molded Products</option>
                <option value="HACH">HACH</option>
                <option value="OTHER">OTHER</option>
            </select>
        </p>
        <p>
            <label for="requirements">Requirements</label>
            <input type="text" id="requirements" name="requirements" value="">
        </p>
        <div>
            <input type="submit" value="Submit">
        </div>
    </form>
</div>
<h3>
    <div class="center content" style="max-width: 75%; width: 100%;">
        <input type="text" id="productSearch" onkeyup="searchTable()" placeholder="Search..." title="Type in a name">
        <table id="productTable">
            <thead>
                <tr>
                    <th onclick="sortTable(0)"> BMP ID# </th>
                    <th onclick="sortTable(1)"> Product Description </th>
                    <th onclick="sortTable(2)"> Customer </th>
                    <th onclick="sortTable(3)"> Last QC Record </th>
                    <th onclick="sortTable(4)"> Requirements </th>
                    {% if current_user.is_authenticated %}
                    <!-- <th>Edit</th> -->
                    <th>Delete</th>
                    {% endif %}
                </tr>
            </thead>
            {% for product in results %}
            <tbody>
                <tr>
                    <td>{{ product.bmpid }}</td>
                    <td>{{ product.desc }}</td>
                    <td>{{ product.customer }}</td>
                    <td>{{ product.lastqc }}</td>
                    <td class="reqs">{{ product.requirements}}</td>
                    {% if current_user.is_authenticated %}
                    <!-- <td><img src="../static/edit.png"></td> -->
                    <td><a onclick="deleteProduct({{ product.id }}, {{ product.bmpid }}, '{{ product.desc }}')"><img src="../static/trash.png"></a></td>
                    {% endif %}
                </tr>
            </tbody>
            {% endfor %}
        </table>
        <h4>{{ no_products }}</h4>
    </div>
</h3>
<script>
    var x = document.getElementsByClassName("reqs").length;
    for (var i = 0; i < x; i++) {
        var info = document.getElementsByClassName("reqs")[i].innerText.replace(/'/g, '"');
        // console.log(info)
        var obj = JSON.parse(info);
        // console.log(obj);
        document.getElementsByClassName("reqs")[i].innerHTML = ("");
        var first = true;
        for (var key in obj) {
            if (!first) {
                document.getElementsByClassName("reqs")[i].innerHTML += ("<br>");
            } first = false;
            var value = obj[key];
            // console.log(key + ", " + value);
            document.getElementsByClassName("reqs")[i].innerHTML += (key + " = " + value);
        }
    }
</script>
{% endblock %}